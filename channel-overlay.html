<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambio de canal</title>
    <link rel="icon" type="image/png" href="https://portal.app.flow.com.ar/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;800;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{background:#111;color:#fff;font-family:Roboto,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;position:relative;user-select:none}.version-info{position:absolute;top:10px;left:10px;font-size:10px;color:rgba(255,255,255,.2);z-index:1000;font-family:monospace}.channel-info-container{position:absolute;top:30px;right:30px;display:flex;align-items:center;gap:0;z-index:10;height:104px}.channel-name-header{width:320px;text-align:right;color:#fff;font-family:Roboto,sans-serif;font-weight:600;text-shadow:2px 2px 4px rgba(0,0,0,.8);display:flex;align-items:center;justify-content:flex-end;height:100%;white-space:pre-line}.channel-name-header.small{font-size:52px;line-height:52px}.channel-name-header.medium{font-size:48px;line-height:52px}.channel-name-header.large{font-size:44px;line-height:47px}.channel-name-header.searching{font-size:52px;line-height:54px;color:#fff;width:450px;display:flex;align-items:center;justify-content:flex-end}.search-cursor{display:inline-block;width:3px;height:50px;background-color:#00DEA5;margin-left:2px;animation:blink 1s infinite;vertical-align:text-bottom;position:relative;top:-2px}@keyframes blink{0%,49%{opacity:1}50%,100%{opacity:0}}.channel-separator{width:10px;height:80px;background:#00DEA5;margin:0 24px 0 32px;flex-shrink:0}.channel-number{font-size:64px;font-weight:600;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.8);font-family:Roboto,sans-serif;text-align:center;display:flex;align-items:center;justify-content:center;width:100px;height:100%;flex-shrink:0}.channel-number.searching{font-size:40px;color:#00DEA5}.channel-container{text-align:center;animation:fadeIn .2s ease-in-out}.channel-logo{width:800px;height:250px;display:flex;align-items:center;justify-content:center;margin:0 auto;background:0 0;border:none}.channel-logo img{max-width:100%;max-height:100%;object-fit:contain}.spinner{width:120px;height:120px;border:16px solid rgba(0,222,165,.3);border-top:16px solid #00DEA5;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.loading-bar{position:absolute;bottom:0;left:0;width:100%;height:12px;background:rgba(255,255,255,.1);overflow:hidden}.loading-progress{height:100%;background:linear-gradient(90deg,#fff,#f0f0f0);width:0;transition:width 1s linear}.loading-progress.closing{background:linear-gradient(90deg,#00DEA5,#00c494);transition:width 2s linear}.search-suggestions{position:absolute;top:150px;right:30px;border-radius:12px;padding:25px 31px;min-width:625px;max-width:780px;display:none;z-index:20}.search-suggestions.visible{display:block;animation:slideDown .2s ease-out}@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.suggestion-item{padding:19px 22px;margin:8px 0;background:rgba(255,255,255,.05);border-radius:10px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:22px}.suggestion-item:hover,.suggestion-item.selected{background:rgba(0,222,165,.2);border-left:6px solid #00DEA5;padding-left:16px}.suggestion-number{font-size:31px;font-weight:600;color:#00DEA5;min-width:62px}.suggestion-name{font-size:28px;color:#fff}@keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.quick-change{animation:quickFlash .15s ease-out}@keyframes quickFlash{0%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:.8}100%{transform:scale(1);opacity:1}}.search-icon{width:41px;height:39px;display:inline-block}
    </style>
</head>
<body>
    <div class="version-info">v5.1.2</div>
    <div class="channel-info-container">
        <div class="channel-name-header" id="channelNameHeader">Canal</div>
        <div class="channel-separator"></div>
        <div class="channel-number" id="channelNumber">--</div>
    </div>
    <div class="search-suggestions" id="searchSuggestions"></div>
    <div class="channel-container" id="channelContainer">
        <div class="channel-logo" id="channelLogo">
            <span style="font-size:32px;color:rgba(255,255,255,.3)">LOGO</span>
        </div>
    </div>
    <div class="loading-bar"><div class="loading-progress" id="loadingProgress"></div></div>
    <script>
        const channels=[{id:66,name:"América",number:9},{id:69,name:"Telefe",number:10},{id:77,name:"TV Pública",number:11},{id:75,name:"El Trece",number:12},{id:76,name:"El Nueve",number:13},{id:70,name:"TN",number:14},{id:1081,name:"La Nación +",number:15},{id:65,name:"C5N",number:16},{id:269,name:"Crónica",number:17},{id:1025,name:"Canal 26",number:18},{id:262,name:"A24",number:19},{id:64,name:"Ciudad Magazine",number:20},{id:7457,name:"NetTV",number:21},{id:686,name:"Encuentro",number:22},{id:676,name:"CNN",number:23},{id:8398,name:"IP Noticias",number:24},{id:9117,name:"Bravo TV",number:25},{id:7097,name:"Diputados TV",number:36},{id:10017,name:"MIX TV",number:85},{id:270,name:"DeporTV",number:100},{id:74,name:"TyC Sports",number:101},{id:280,name:"ESPN",number:102},{id:278,name:"ESPN2",number:103},{id:72,name:"ESPN3",number:104},{id:279,name:"ESPN4",number:105},{id:73,name:"FOX Sports",number:106},{id:292,name:"FOX Sports 2",number:107},{id:293,name:"FOX Sports 3",number:108},{id:710,name:"NBA TV",number:111},{id:641,name:"Discovery Turbo",number:112},{id:713,name:"Paka Paka",number:200},{id:275,name:"Disney Channel",number:201},{id:6857,name:"Nickelodeon",number:202},{id:71,name:"Cartoon Network",number:203},{id:9140,name:"DreamWorks",number:204},{id:679,name:"Discovery Kids",number:205},{id:266,name:"WB Cartoonito",number:206},{id:276,name:"Disney Junior",number:207},{id:264,name:"BabyTV",number:208},{id:726,name:"Tooncast",number:209},{id:711,name:"Nick Jr.",number:210},{id:9657,name:"Plim Plim TV",number:211},{id:9937,name:"KidOO",number:212},{id:701,name:"CineAR",number:300},{id:673,name:"Cinemax",number:301},{id:732,name:"Volver",number:303},{id:67,name:"Space",number:304},{id:267,name:"CineCanal",number:305},{id:6877,name:"TNT",number:306},{id:322,name:"TNT Series",number:307},{id:294,name:"FX",number:308},{id:123,name:"Star Channel",number:309},{id:124,name:"Sony",number:310},{id:298,name:"Warner TV",number:311},{id:731,name:"Universal TV",number:312},{id:263,name:"AXN",number:313},{id:718,name:"Studio Universal",number:314},{id:242,name:"A&E",number:315},{id:9497,name:"USA",number:317},{id:722,name:"TCM",number:318},{id:261,name:"AMC",number:319},{id:9717,name:"Golden",number:322},{id:9139,name:"Sony Movies",number:323},{id:642,name:"Discovery ID",number:325},{id:714,name:"Paramount",number:327},{id:9737,name:"TLNovelas",number:333},{id:9537,name:"Adult Swim",number:335},{id:692,name:"Lifetime",number:400},{id:295,name:"El Gourmet",number:401},{id:901,name:"Food Network",number:402},{id:272,name:"Discovery Home & Health",number:405},{id:703,name:"Más Chic",number:406},{id:1027,name:"TLC",number:407},{id:8417,name:"HGTV",number:408},{id:1254,name:"Canal LUZ",number:427},{id:300,name:"National Geographic",number:450},{id:271,name:"Discovery",number:451},{id:643,name:"Animal Planet",number:452},{id:725,name:"Discovery Theater",number:453},{id:301,name:"History",number:454},{id:698,name:"History 2",number:458},{id:691,name:"Film & Arts",number:457},{id:681,name:"Discovery World",number:460},{id:680,name:"Discovery Science",number:462}];
        let ci=0,cct=null,ct=null,icc=false,lat=Date.now(),iwn=false,is=false,wt=null,cwn='',cst='',cp=0,sr=[],ssi=0;
        const up=new URLSearchParams(window.location.search),sci=parseInt(up.get('channelId')),id=up.get('direction'),wn=up.get('writing');
        if(sci){const i=channels.findIndex(ch=>ch.id===sci);if(i!==-1)ci=i;}
        function nt(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"");}
        function cs(s,t){const ns=nt(s),nt1=nt(t);if(nt1.startsWith(ns))return 1000+ns.length;if(nt1.includes(ns))return 500+ns.length;let sc=0,si=0;for(let i=0;i<nt1.length&&si<ns.length;i++)if(nt1[i]===ns[si]){sc+=10;si++;}return si===ns.length?sc:0;}
        function sch(q){if(!q||q.trim()==='')return[];return channels.map(ch=>({channel:ch,score:cs(q,ch.name)})).filter(r=>r.score>0).sort((a,b)=>b.score-a.score).slice(0,5).map(r=>r.channel);}
        function sss(r){const c=document.getElementById('searchSuggestions');if(r.length===0){c.classList.remove('visible');return;}c.innerHTML=r.map((ch,i)=>`<div class="suggestion-item ${i===ssi?'selected':''}" data-index="${i}"><span class="suggestion-number">${ch.number}</span><span class="suggestion-name">${ch.name}</span></div>`).join('');c.classList.add('visible');c.querySelectorAll('.suggestion-item').forEach(item=>{item.addEventListener('click',()=>{ss(parseInt(item.dataset.index));});});}
        function hss(){document.getElementById('searchSuggestions').classList.remove('visible');}
        function fcbn(n){return channels.find(ch=>ch.number===parseInt(n));}
        function sls(){document.getElementById('channelLogo').innerHTML='<div class="spinner"></div>';}
        function usd(st){is=true;cst=st;clearTimeout(ct);clearTimeout(cct);const p=document.getElementById('loadingProgress');p.style.width='0%';p.className='loading-progress';sls();const cn=document.getElementById('channelNumber'),cnh=document.getElementById('channelNameHeader');cn.innerHTML='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 49 47" width="51" height="49" style="enable-background:new 0 0 49 47;" xml:space="preserve"><style type="text/css">.st0{fill:#FFFFFF;}</style><path class="st0" d="M47.8,40.2L36.5,28.9c1.6-2.8,2.5-6,2.5-9.5C39,8.7,30.3,0,19.5,0C8.8,0,0,8.7,0,19.4 c0,10.8,8.8,19.4,19.5,19.4c4.4,0,8.5-1.5,11.7-3.9l10.9,10.9c1.6,1.6,4.1,1.6,5.7,0C49.4,44.3,49.4,41.7,47.8,40.2z M19.5,30.9 C13.1,30.9,8,25.8,8,19.4C8,13.1,13.1,8,19.5,8C25.9,8,31,13.1,31,19.4C31,25.8,25.9,30.9,19.5,30.9z"/></svg>';cn.className='channel-number searching';const b=st.slice(0,cp),a=st.slice(cp);cnh.innerHTML=`<div style="word-wrap:break-word;overflow-wrap:break-word;text-align:right;width:100%">${b}<span class="search-cursor"></span>${a}</div>`;cnh.className='channel-name-header searching';sr=sch(st);ssi=0;sss(sr);}
        function ss(i){if(i>=0&&i<sr.length){const sc=sr[i],ti=channels.findIndex(ch=>ch.id===sc.id);if(ti!==-1){ci=ti;cas();ucd();const p=document.getElementById('loadingProgress');p.className='loading-progress';p.style.width='0%';cct=setTimeout(()=>{ufc();p.className='loading-progress closing';setTimeout(()=>{p.style.width='100%';},50);},1000);ct=setTimeout(()=>{window.close();},4000);}}}
        function cfs(){if(sr.length>0)ss(ssi);else cas();}
        function cas(){is=false;cst='';cp=0;sr=[];ssi=0;clearTimeout(wt);hss();document.getElementById('channelNumber').className='channel-number';const cnh=document.getElementById('channelNameHeader');cnh.className='channel-name-header';cnh.innerHTML='';ucd();}
        function uwd(wn1){iwn=true;cwn=wn1;clearTimeout(ct);const p=document.getElementById('loadingProgress');p.style.width='0%';p.className='loading-progress';sls();document.getElementById('channelNumber').textContent=wn1;const tc=fcbn(wn1),cnh=document.getElementById('channelNameHeader');if(tc){const ml={'Ciudad Magazine':'Ciudad\nMagazine','Discovery Turbo':'Discovery\nTurbo','Studio Universal':'Studio\nUniversal','Discovery Home & Health':'Discovery\nHome & Health','Discovery World':'Discovery\nWorld','Disney Junior':'Disney\nJunior'},dn=ml[tc.name]||tc.name,nl=tc.name.length;cnh.textContent=dn;cnh.className='channel-name-header';const fme=['FOX Sports 2','FOX Sports 3','Diputados TV','Universal TV'],fle=['Cartoon Network','Studio Universal','Discovery Turbo','Discovery Theater','Discovery World','Discovery Science'];if(fme.includes(tc.name))cnh.classList.add('small');else if(fle.includes(tc.name))cnh.classList.add('medium');else if(nl<=10)cnh.classList.add('small');else if(nl<=14)cnh.classList.add('medium');else cnh.classList.add('large');}else{cnh.textContent='-';cnh.className='channel-name-header large';}}
        function ccc(){const tc=fcbn(cwn);if(tc){const ti=channels.findIndex(ch=>ch.number===tc.number);if(ti!==-1){ci=ti;iwn=false;cwn='';ucd();const p=document.getElementById('loadingProgress');p.className='loading-progress';p.style.width='0%';cct=setTimeout(()=>{ufc();p.className='loading-progress closing';setTimeout(()=>{p.style.width='100%';},50);},1000);ct=setTimeout(()=>{window.close();},4000);}}else cnw();}
        function cnw(){iwn=false;cwn='';clearTimeout(wt);ucd();}
        function hdi(d){if(cwn.length>=4){cnw();return;}cwn+=d;uwd(cwn);clearTimeout(wt);clearTimeout(cct);const wt1=cwn.length===1?2000:1000;wt=setTimeout(()=>{ccc();},wt1);}
        function hli(c){if(cst.length>=30)return;const b=cst.slice(0,cp),a=cst.slice(cp);cst=b+c+a;cp++;usd(cst);clearTimeout(wt);wt=setTimeout(()=>{cfs();},2000);}
        function ucd(an=true){const ch=channels[ci];document.getElementById('channelNumber').textContent=ch.number;document.getElementById('channelNumber').className='channel-number';const cnh=document.getElementById('channelNameHeader'),ml={'Ciudad Magazine':'Ciudad\nMagazine','Discovery Turbo':'Discovery\nTurbo','Studio Universal':'Studio\nUniversal','Discovery Home & Health':'Discovery\nHome & Health','Discovery World':'Discovery\nWorld','Disney Junior':'Disney\nJunior'},dn=ml[ch.name]||ch.name,nl=ch.name.length;cnh.textContent=dn;cnh.className='channel-name-header';const fme=['FOX Sports 2','FOX Sports 3','Diputados TV','Universal TV'],fle=['Cartoon Network','Studio Universal','Discovery Turbo','Discovery Theater','Discovery World','Discovery Science'];if(fme.includes(ch.name))cnh.classList.add('small');else if(fle.includes(ch.name))cnh.classList.add('medium');else if(nl<=10)cnh.classList.add('small');else if(nl<=14)cnh.classList.add('medium');else cnh.classList.add('large');const lc=document.getElementById('channelLogo');lc.innerHTML=`<img src="https://cdn.jsdelivr.net/gh/daniel-pernigotti/flow-channel-guide/logos/${ch.id}.png" alt="${ch.name}" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/daniel-pernigotti/flow-channel-guide/logos/${ch.id}.webp';this.onerror=function(){this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/daniel-pernigotti/flow-channel-guide/logos/${ch.id}.svg';this.onerror=function(){this.style.display='none';this.nextElementSibling.style.display='block';};};"><span style="font-size:32px;color:rgba(255,255,255,.3);display:none">LOGO</span>`;if(an){const c=document.getElementById('channelContainer');c.classList.remove('quick-change');void c.offsetWidth;c.classList.add('quick-change');}if(!window.imagesPreloaded){channels.forEach(ch=>{const ip=new Image();ip.src=`https://cdn.jsdelivr.net/gh/daniel-pernigotti/flow-channel-guide/logos/${ch.id}.png`;const iw=new Image();iw.src=`https://cdn.jsdelivr.net/gh/daniel-pernigotti/flow-channel-guide/logos/${ch.id}.webp`;});window.imagesPreloaded=true;}}
        function ufc(){const ch=channels[ci],nu=`https://portal.app.flow.com.ar/epg?channelId=${ch.id}`;if(window.opener&&!window.opener.closed){window.opener.postMessage({action:'updateChannel',channelId:ch.id},'*');try{window.opener.location.href=nu;icc=true;}catch(e){console.log('No se pudo cambiar directamente, usando postMessage');}}}
        function cc(d){if(iwn){cnw();return;}clearTimeout(cct);clearTimeout(ct);icc=false;if(d==='up')ci=(ci+1)%channels.length;else ci=(ci-1+channels.length)%channels.length;ucd();const p=document.getElementById('loadingProgress');p.className='loading-progress';p.style.width='0%';cct=setTimeout(()=>{ufc();p.className='loading-progress closing';setTimeout(()=>{p.style.width='100%';},50);},1000);ct=setTimeout(()=>{window.close();},4000);lat=Date.now();}
        document.addEventListener('keydown',(e)=>{if(e.key>='0'&&e.key<='9'){e.preventDefault();if(is)cas();hdi(e.key);}else if(e.key.length===1&&e.key.match(/[a-zñáéíóú]/i)){e.preventDefault();if(iwn)cnw();hli(e.key);}else if(e.key===' '){if(is){e.preventDefault();hli(' ');}}else if(e.key==='ArrowUp'){e.preventDefault();if(is){ssi=(ssi-1+sr.length)%sr.length;sss(sr);clearTimeout(wt);}else if(!iwn)cc('up');}else if(e.key==='ArrowDown'){e.preventDefault();if(is){ssi=(ssi+1)%sr.length;sss(sr);clearTimeout(wt);}else if(!iwn)cc('down');}else if(e.key==='ArrowLeft'){if(is){e.preventDefault();if(cp>0){cp--;usd(cst);}}}else if(e.key==='ArrowRight'){if(is){e.preventDefault();if(cp<cst.length){cp++;usd(cst);}}}else if(e.key==='Home'){if(is){e.preventDefault();cp=0;usd(cst);}}else if(e.key==='End'){if(is){e.preventDefault();cp=cst.length;usd(cst);}}else if(e.key==='Enter'){e.preventDefault();if(is){clearTimeout(wt);cfs();}else if(iwn){clearTimeout(wt);ccc();}}else if(e.key==='Escape'){e.preventDefault();if(is)cas();else if(iwn)cnw();else window.close();}else if(e.key==='Backspace'){e.preventDefault();if(is&&cst.length>0){if(e.ctrlKey){const b=cst.slice(0,cp),a=cst.slice(cp),w=b.trimEnd().split(/\s+/);w.pop();const nb=w.join(' ')+(w.length>0?' ':'');cst=nb+a;cp=nb.length;}else{if(cp>0){const b=cst.slice(0,cp-1),a=cst.slice(cp);cst=b+a;cp--;}}if(cst.length===0)cas();else{usd(cst);clearTimeout(wt);wt=setTimeout(()=>{cfs();},2000);}}else if(iwn&&cwn.length>0){cwn=cwn.slice(0,-1);if(cwn.length===0)cnw();else{uwd(cwn);clearTimeout(wt);const wt1=cwn.length===1?2000:1000;wt=setTimeout(()=>{ccc();},wt1);}}}else if(e.key==='Delete'){if(is&&cp<cst.length){e.preventDefault();const b=cst.slice(0,cp),a=cst.slice(cp+1);cst=b+a;if(cst.length===0)cas();else{usd(cst);clearTimeout(wt);wt=setTimeout(()=>{cfs();},2000);}}}else if(e.key==='F11'){e.preventDefault();if(!document.fullscreenElement)document.documentElement.requestFullscreen().catch(err=>{console.log('No se pudo activar fullscreen:',err);});else document.exitFullscreen();}});
        window.addEventListener('message',(e)=>{if(e.data&&e.data.action==='changeChannel')cc(e.data.direction);else if(e.data&&e.data.action==='writeNumber')hdi(e.data.digit);});
        if(wn){uwd(wn);cwn=wn;const wt1=wn.length===1?2000:1000;wt=setTimeout(()=>{ccc();},wt1);}else ucd(false);
        if(id&&!wn){setTimeout(()=>{const p=document.getElementById('loadingProgress');p.style.width='50%';cct=setTimeout(()=>{ufc();p.className='loading-progress closing';p.style.width='100%';},1000);ct=setTimeout(()=>{window.close();},4000);},100);}
        window.addEventListener('beforeunload',(e)=>{if((!icc&&Date.now()-lat<5000)||iwn||is){e.preventDefault();e.returnValue='';}});
    </script>
</body>
</html>
